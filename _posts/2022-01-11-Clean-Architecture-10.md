---
layout: post
title: "Clean Architecture 10장 - 아키텍처 경계 강제하기"
description: Clean Architecture 10장 
date: 2022-01-11 22:24:00 +09:00
categories: Clean Architecture Study
---

# 아키텍처 경계 강제하기

## 경계와 의존성
- 가장 안쪽의 도메인 엔티티
- 어플리케이션 계층은 어플리케이션 서비스 안에 유스케이스를 구현하기 위해 도메인 엔티티에 접근
- 어댑터는 인커밍 포트를 통해 서비스에 접근하고, 서비스는 아웃고잉 포트를 통해 어댑터에 접근
- 설정 계층은 어댑터와 서비스 객체를 생성할 팩토리를 포함하고있고 DI 매커니즘을 제공
- 각 계층 사이, 안쪽 인접 계층과 바깥쪽 인접 계층 사이에는 항상 경계가 있으며, 의존성 규칙에 따라 계층 경계를 넘는 의존성은 항상 안쪽 방향으로 향해야 함

## 접근제한자
- package-private(default)는 자바 패키지를 통해 클래스들을 응집적인 모듈로 만들어주기 때문에 중요 하다. 이러한 모듈 내에 있는 클래스는 서로 접근이 가능하지만 패키지 바깥에서 접근 할수는 없다. 모듈의 진입점만 골라서 public으로 만들면 된다
- package-private 는 몇개 정도의 클래스로만 이뤄진 작은 모듈에서 가장 효과적. 하위 패키지는 다른 패키지로 취급하는 자바의 특성상 하위 패키지의 package-private 멤버에 접근이 불가능 하므로 의존성 규칙이 꺠지기 쉽다

## 컴파일 후 체크
- 코드가 컴파일 된 이후 런타임에 체크하는 방법인데 ArchUnit등의 도구를 사용함
- ArchUnit은 의존성 방향이 기대한대로 잘 설정되있는지 체크하는 API가 제공되고, 의존성 규칙 위반을 발견하면 예외를 던지며, JUnit과 같은 단위 테스트 프레임워크 기반에서 잘 동작함

## 빌드 아티팩트
- 빌드 아티팩트는 빌드 프로세스의 결과물. 빌드 도구의 주요한 기능중 하나는 의존성 해결이고, 어떤 코드 베이스를 빌드 아티팩트로 변환하기 위해 빌드 도구가 가장 먼저 할 일은 코드 베이스가 의존하고 있는 모든 아티팩트가 사용 가능한지 확인 하는것
- 이를 활용해서 모듈과 아키텍처의 계층간의 의존성 강제 가능(경계를 강제하는 효과). 각 모듈 혹은 계층에 대해 전용 코드베이스와 빌드 아티팩트로 분리된 빌드 모듈(JAR 파일)을 만들 수 있음
- 빌드 도구가 순환 의존성을 허용하지 않기 때문에, 빌드 도구를 이용하면 빌드 모듈간 순환 의존성이 없음을 확신 할 수 있다
- 다른 모듈을 고려하지 않고 특정 모듈의 코드를 격리한채로 변경 할수 있다는 장점도 있다
- 모듈가느이 의존성이 빌드 스크립트에 분명하게 선언되어 있기 때문에 새로 의존성을 추가하는 일은 의식적인 행동이 되어서 정말로 이 의존성이 필요한지 생각할 여지가 생긴다
- 하지만 빌드 스크립트를 유지보수하는 비용이 수반되기 때문에 아키텍처를 여러개의 빌드 모듈로 나누기 전에 아키텍처 안정화가 필요하다

## 유지보수 가능한 소프트웨어를 만드는데 어떻게 도움이 될까?
- 기본적으로 소프트웨어 아키텍처는 아키텍처 요소간의 의존성을 관리하는게 전부. 의존성이 올바른 방향을 가리키는지 지속적으로 확인 해야 한다
