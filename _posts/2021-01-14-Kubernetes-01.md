---
layout: post
title: "Kubernetes : 쿠버네티스 아키텍처"
description: Kubernetes - 쿠버네티스 아키텍처
date: 2021-01-14 15:13:00 +09:00
categories: Kubernetes Study
---

# 쿠버네티스 클러스터 아키텍처
- 쿠버네티스의 클러스터는 하드웨어 수준에서 많은 노드로 구성되며 2가지 유형으로 나뉨
    * 마스터 노드: 전체 쿠버네티스 시스템을 관리하고 통제하는 쿠버네티스 컨트롤 플레인을 관장
    * 워커 노트: 실제 배포하고자 하는 애플리케이션 실행을 담당
    * 마스터 노드에서 워커 노드 없이 가능 하지만, 보통은 나눠서 함

- 마스터의 컨트롤 플레인 안에는 명령을 내리는 kube-apiserver가 있고, 워커노드에는 명령을 받는 kubelet이 있음
    * 컨트롤 플레인은 클러스터를 관리하는 기능, 단일 마스터에서 돌아가기도 하고, 여러 마스터 노드에 분할되고 복제되어 고가용성을 보장. 클러스터의 상태를 유지하고 제어하지만 애플리케이션을 실행하지는 않음(애플리케이션도 실행은 가능하지만, 일반적인 경우는 아님)
    * 워커노드는 컨테이너화된 애플리케이션을 실행하는 시스템
    * kube-apiserver는 사용자 인증같은걸 담당하기도 하고, 마스터 노드 내부의 통신 및 마스터노드와 워커노드의 kubelet과의 통신을 담당. 사실상 컨트롤 타워
    * kube-apiserver의 데이터베이스는 etcd를 씀
    * kube-scheduler와 control-manager 도 있음. 각각 스케줄링 알고리즘(어느 노드에 뭘 배치할지)이나 관련 리소스(yaml 파일과 같은 리소스등) 담당하고 있음
    * 사실상 kube-apiserver는 일을 그렇게 하는것이 아님. 통신을 담당하기 때문
    * kubelet은 kube-apiserver의 명령을 받아서 컨테이너를 배치하고 일을 시킴
    * 워커노드 내부에는 kube-proxy도 있는데, 컨테이너 내부 통신이나 워커노트 사이의 통신을 담당

- 쿠버네티스에서 어플리케이션 실행 flow
    * 개발자가 자기가 필요한 도커 이미지를 이미지 레지스트리에 푸시
    * 앱 디스크립터(yaml or json)으로 어떤 이미지를 어떻게 배치할지, 어떤 특성을 반영해 배치할지를 적은 문서를 작성(이미지가 들어있진 않음, 방법만 적혀있음)
    * 앱 티스크립터를 컨트롤 플레인에게 넘기면, 컨트롤 플레인이 적합한 사용자인지 판단해서 이를 워커노드에 넘김
    * 컨트롤 플레인이 각 워커노드에 적절하게 분산하면, 각 워커 노드들이 레지스트리에서 각 도커 이미지를 받아서 컨테이너 구성후 실행



