---
layout: post
title: "Effective Kotlin - 아이템48: 더이상 사용하지 않는 객체의 레퍼런스를 제거하라"
description: 더이상 사용하지 않는 객체의 레퍼런스를 제거하라
date: 2022-03-13 12:45:00 +09:00
categories: EffectiveKotlin Study
---


# 비용 줄이기

## 아이템 48: 더이상 사용하지 않는 객체의 레퍼런스를 제거하라

- 메모리 관리를 자동으로 해준다고 하더라도 메모리 관리를 완전히 무시해버리면 메모리 누수가 발생해서 상황에 따라 OOM이 발생하기도 함
- 어떤 객체가 메모리를 많이 차지하거나, 어떤 객체의 인스턴스가 많이 생성될 경우에는 꼭 `더이상 사용하지 않는 객체의 레퍼런스를 유지하면 안된다` 의 규칙을 지켜야함

```kotlin

// 스택의 일부
fun pop(): Any? {
    if( size == 0 ) 
        throw EmptyStackException()
    return elements[--size] // 배열의 요소를 해제하지 않으므로 메모리 누수 발생
}

fun pop(): Any? {
    if( size == 0 ) 
        throw EmptyStackException()
    val elem = elements[--size] 
    elements[size] = null // 배열의 요소를 해제 해줌으로써 메모리 누수 제거
    return elem
}
```

- 쓸데없는 최적화가 모든 악의 근원이라는 말도 있지만, 오브젝트에 null을 설정하는것은 그렇게 어려운일이 아니므로 무조건 하는것이 좋음
- 많은 변수를 캡쳐할 수있는 함수타입, Any또는 제너릭 타입과 같은 미지의 클래스에서는 더욱 중요함
- 일반적으로 메모리 누수가 발생하는 부분
    * 절대 사용되지 않는 객체를 캐시해서 저장해두는것 -> 소프트 레퍼런스를 사용해서 해결
    * 화면 위의 대화상자 등 -> 약한 레퍼런스를 사용하는게 좋을수도 있음

- 사실 객체를 수동으로 해제해야 하는 경우는 굉장히드문데, 일반적으로 스코프를 벗어나면서 어떤 객체를 가리키는 레퍼런스가 제거 될 때 객체가 자동으로 해제되기 때문. 따라서 메모리와 관련된 문제를 피하는 가장 좋은 방법은 변수의 스코프를 최소화 하는것임
